<!DOCTYPE html>
<html lang="en">

<head>
    <title>Mini-Shopify Shop Home</title>
    <meta charset="UTF-8">
    <meta name="author" content="Nicholai Ponomarev">
    <link rel="stylesheet" href="/css/shop_home.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="/js/go_back.js"></script>
    <script>
        function toggleProfileMenuDropdown() {
            const dropdownContent = document.querySelector(".dropdown-account-content");
            const newShopButton = document.querySelector("#add-product-button");

            // Toggle dropdown visibility
            if (dropdownContent.style.display === "block") {
                dropdownContent.style.display = "none"; // Hide dropdown
                newShopButton.style.display = "block";  // Show "Create Shop" button
            } else {
                dropdownContent.style.display = "block"; // Show dropdown
                newShopButton.style.display = "none";   // Hide "Create Shop" button
            }
        }

        window.onclick = function (event) {
            const dropdownContent = document.querySelector(".dropdown-account-content");
            const dropdownButton = document.querySelector(".dropdown-account-button");

            // Close dropdown if the user clicks outside the button and dropdown
            if (!event.target.matches('.dropdown-account-button') && !event.target.matches('.dropdown-account-content') && !event.target.matches('#add-product-button')) {
                if (dropdownContent) {
                    dropdownContent.style.display = "none"; // Hide dropdown
                }
            }
        }

    </script>
</head>

<body>
    <div class="header-bar">
        <img src="/images/Mini-Shopify Logo.png" alt="Mini-Shopify Logo" style="width: 50px; height: 50px;">
        <form id="search-bar" action="/home/search/results" method="get">
            <input type="search" id="searchString" name="searchString" placeholder="Search by shop name or tags...">
            <input type="hidden" name="buyerId" th:value="${buyerId}">
            <button type="submit">Search</button>
        </form>
        <div class="dropdown-account-menu">
            <button onclick="toggleProfileMenuDropdown()" class="dropdown-account-button">
                <i class="fa fa-user"></i> Account
            </button>
            <div class="dropdown-account-content">
                <a href="#">Manage Account</a>
                <a href="/index">Logout</a>
            </div>
        </div>
    </div>
    <div class="main-content">
        <aside class="side-menu">
            <div class="menu-item"><i class="fa fa-home" aria-hidden="true" onclick="goBack('/home/buyer/' + ${buyer.id})"></i>
                <p> Home</p>
            </div>
            <div class=" menu-item"><i class="fa fa-shopping-cart"></i>
                <button th:if="${buyerId}" th:onclick="'location.href=\'/home/carts/' + ${buyerId} + '\';'"> Cart</button>
                <p th:if="${buyerId} == null"> Orders</p>
            </div>
            <div class="menu-item"><i class="fa fa-cog"></i>
                <p> Settings</p>
            </div>
        </aside>
        <main class="content-area">
            <div class="page-title-div">
                <div>
                    <h1 th:text="${shop.name} + ' Shop'">Shop Dashboard</h1>
                    <p>Manage your business activities, check orders, and stay on top of inventory and customer needs.
                    </p>
                </div>
            </div>
            <h1 style="margin-top: 20px;">Products</h1>
            <section class="tiles-container">
                <div class="tile" th:each="items : ${shop.inventory.itemQuantityPairs}">
                    <h2 th:text="${items.product.name}">Product Name</h2>
                    <h5 th:text="'Description: ' + ${items.product.description}">Product Description</h5>
                    <h5 th:text="'  Price: $' + ${items.product.price}">Product Price</h5>
                    <img th:src="${items.product.imagePath}" alt="Item Stock Image 1">
                    <h5 th:text="'Available inventory: ' + ${items.quantity}">Product Inventory</h5>
                    <form th:if="${buyerId}" th:action="@{/home/buyer/{buyerId}/{shopId}(buyerId=${buyerId}, shopId=${shop.getId()})}" method="post" style="display: inline;">
                        <label>
                            Quantity:
                            <input type="number" name="quantity" th:value="1" min="1" style="width: 50px;">
                            <input type="hidden"  name="productName" th:value="${items.product.name}">
                            <input type="hidden" name="productDescription" th:value="${items.product.description}">
                            <input type="hidden" name="productPrice" th:value="${items.product.price}">
                            <input type="hidden" name="productImg" th:value="${items.product.imagePath}">
                        </label>
                        <button type="submit">Add to cart</button>
                    </form>
                    <div th:if="${alertItemName == items.product.name}" class="alert">
                        <p th:text="${alertMessage}"></p>
                    </div>
                </div>
            </section>
        </main>
    </div>
</body>

</html>